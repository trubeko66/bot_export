# Автоматизация авторизации в Docker

## Быстрый старт

### 1. Настройка
```bash
# Скопируйте шаблон настроек
copy .env.template .env

# Заполните в .env:
BOT_TOKEN=ваш_токен_бота
API_ID=ваш_api_id
API_HASH=ваш_api_hash
PHONE_NUMBER=+79123456789  # ОБЯЗАТЕЛЬНО с + и кодом страны!
CLOUD_PASSWORD=ваш_пароль_2fa  # если включена 2FA
```

### 2. Авторизация

**Windows (обновлено для docker compose):**
```cmd
docker-auth-new.bat
```

**Linux/macOS (обновлено для docker compose):**
```bash
chmod +x docker-auth-new.sh
./docker-auth-new.sh
```

**Интерактивное тестирование (при проблемах с кодом):**
```bash
# Диагностика и интерактивная авторизация
py interactive_auth_test.py
```

**Ручная авторизация:**
```bash
# 1. Запустите контейнер
docker compose up -d

# 2. Получите код из Telegram и выполните:
docker compose exec -e TELEGRAM_CODE=ваш_код telegram-bot python auto_auth.py
```

### 3. Запуск бота
```bash
docker compose up -d
```

## ⚠️ ВАЖНО: docker-compose УСТАРЕЛ

Используйте новую команду `docker compose` (без дефиса):
- ✅ `docker compose up -d`
- ❌ `docker-compose up -d` (устарело)

## Решение проблем с кодом авторизации

### Код не приходит?
1. **Проверьте номер телефона**: должен быть `+79123456789` (с + и кодом страны)
2. **Проверьте API данные**: получите новые на https://my.telegram.org
3. **Используйте интерактивный тест**: `py interactive_auth_test.py`

### Основные ошибки:
- "Invalid phone number" → неправильный формат номера
- "API ID or Hash cannot be empty" → проверьте .env файл
- "Phone code expired" → код действителен 5 минут
- "Flood wait" → слишком много попыток, подождите

## Тестирование
```bash
# Проверка системы
py test_auth.py

# Интерактивная диагностика
py interactive_auth_test.py

# Тест авторизации
py auto_auth.py
```

## Управление Docker
```bash
# Статус
docker compose ps

# Логи
docker compose logs -f

# Остановка
docker compose down

# Перезапуск
docker compose restart
```

## Решение проблем

### "Номер телефона не указан"
Проверьте `PHONE_NUMBER` в .env (формат: +79123456789)

### "Код подтверждения не найден"
1. Получите код из Telegram
2. Установите: `set TELEGRAM_CODE=код` (Windows) или `export TELEGRAM_CODE=код` (Linux)
3. Запустите авторизацию повторно

### "Облачный пароль не указан"
Если включена 2FA, укажите `CLOUD_PASSWORD` в .env

### "Код не приходит"
1. Проверьте формат номера телефона (обязательно с +)
2. Убедитесь что API_ID и API_HASH правильные
3. Попробуйте интерактивную авторизацию

## Файлы
- `auth_helper.py` - автоматическая авторизация (обновлено)
- `auto_auth.py` - тестовая авторизация  
- `docker-auth-new.sh/bat` - новые скрипты для docker compose
- `interactive_auth_test.py` - интерактивная диагностика
- `test_auth.py` - тестирование системы
- `РЕШЕНИЕ_ПРОБЛЕМЫ_АВТОРИЗАЦИИ.md` - подробное руководство