# Решение проблемы с кодом авторизации в Telegram

## Проблема
Код подтверждения не приходит в Telegram при попытке авторизации в Docker контейнере.

## Диагностика

### 1. Проверьте переменные окружения
Убедитесь что файл `.env` правильно настроен:

```bash
# Скопируйте шаблон если .env не существует
copy .env.template .env
```

В файле `.env` должны быть заполнены:
```env
BOT_TOKEN=ваш_токен_от_botfather
API_ID=ваш_api_id_от_my_telegram_org
API_HASH=ваш_api_hash_от_my_telegram_org
PHONE_NUMBER=+79123456789  # ОБЯЗАТЕЛЬНО с кодом страны и знаком +
```

### 2. Проверьте формат номера телефона
**КРИТИЧНО**: Номер должен быть в международном формате:
- ✅ Правильно: `+79123456789`
- ❌ Неправильно: `79123456789` или `8-912-345-67-89`

### 3. Тестирование подключения

Запустите тест:
```bash
py interactive_auth_test.py
```

Если тест показывает ошибки с API_ID/API_HASH, получите новые учетные данные:
1. Перейдите на https://my.telegram.org
2. Войдите с вашим номером телефона 
3. Создайте новое приложение
4. Скопируйте `api_id` и `api_hash` в .env

## Решение проблемы с кодом

### Вариант 1: Интерактивная авторизация (рекомендуется)

```bash
# Запустите интерактивный тест
py interactive_auth_test.py
```

Этот скрипт:
- Проверит подключение к Telegram API
- Запросит код подтверждения интерактивно
- Поможет диагностировать проблемы

### Вариант 2: Обновленные Docker скрипты

Используйте новые скрипты с командой `docker compose`:

**Windows:**
```cmd
docker-auth-new.bat
```

**Linux/macOS:**
```bash
chmod +x docker-auth-new.sh
./docker-auth-new.sh
```

### Вариант 3: Ручная авторизация

```bash
# 1. Запустите контейнер
docker compose up -d

# 2. Подключитесь к контейнеру для интерактивной авторизации
docker compose exec telegram-bot python interactive_auth_test.py

# 3. Следуйте инструкциям для ввода кода
```

## Часто встречающиеся проблемы

### "API ID or Hash cannot be empty"
- Проверьте что .env файл существует и содержит правильные API_ID и API_HASH
- Убедитесь что нет лишних пробелов или кавычек в .env

### "Invalid phone number"
- Номер должен начинаться с + и кода страны
- Для России: +7, для Украины: +380, для США: +1

### "Phone code expired"
- Код действителен только 5 минут
- Запросите новый код и введите быстрее

### "Phone code invalid"
- Вводите только цифры кода без пробелов
- Убедитесь что код приходит на правильный номер

### "Flood wait"
- Слишком много попыток авторизации
- Подождите указанное время перед новой попыткой

## Команды для отладки

```bash
# Проверка статуса Docker
docker compose ps

# Просмотр логов
docker compose logs telegram-bot

# Остановка контейнера
docker compose down

# Удаление старой сессии для повторной авторизации
del bot_session.session  # Windows
rm bot_session.session   # Linux/macOS
```

## Контакты поддержки

Если проблема не решается:
1. Убедитесь что все переменные окружения правильно заданы
2. Попробуйте интерактивный тест авторизации
3. Проверьте что номер телефона в международном формате
4. Убедитесь что код приходит на указанный номер

**Важно**: Код подтверждения должен приходить на номер телефона, указанный в переменной `PHONE_NUMBER` в файле `.env`.